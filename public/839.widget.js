"use strict";(this.webpackChunkWidget=this.webpackChunkWidget||[]).push([[839],{3839:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var o=n(6540),a=n(9965),s=n.n(a);const r="https://cdn.jsdelivr.net/gh/hexdecimal16/chat-widget@main/public";function i(e){if(!e)throw new Error("Asset filename must be provided.");return`${r}/${e}`}var c=n(4848);const d=e=>{let{title:t,onClose:n,leftComponent:o}=e;return(0,c.jsxs)("div",{className:"bg-[#fc6b2d] p-6 flex justify-between items-center relative",children:[o&&(0,c.jsx)("div",{children:o}),(0,c.jsx)("h2",{className:"text-white text-xl font-bold mx-auto",children:t}),(0,c.jsx)(s(),{onClick:n,src:i("close.svg"),alt:"Close",title:"Close",width:20,height:20,className:"cursor-pointer"})]})},l=o.memo(d);var h=n(4953),u=n.n(h),m=n(4164);const g="http://localhost:8000";async function p(e){const t=await fetch(`${g}/api/conversations?user_id=${e}`);return(await t.json()).conversations}async function f(e,t,n){console.log("Sending feedback:",e,t,n);try{await fetch(`${g}/api/feedback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,message_id:t,sentiment:n})})}catch(e){console.error("Error sending feedback:",e)}}const b=u()((()=>Promise.all([n.e(862),n.e(784)]).then(n.bind(n,9784))),{ssr:!1,loading:()=>(0,c.jsx)("p",{children:"Loading..."})}),y=e=>{let{sender:t,message:n,conversationId:a,messageId:s,sentiment:r}=e;const d=r?.toString(),l="positive"===d?"up":"negative"===d?"down":null,[h,u]=(0,o.useState)(l);return n&&0!==n.length?(0,c.jsx)("div",{className:(0,m.A)("p-3 rounded-xl mb-3 relative max-w-[85%]",{user:"self-end bg-[#fc6b2d1a] mr-4 chat-bubble-user",bot:"self-start bg-gray-50 ml-4 chat-bubble-bot",indicator:"self-start ml-4"}[t]),children:"bot"===t?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(b,{content:n}),(0,c.jsx)("div",{className:"flex gap-2 mt-2",children:null===h?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:()=>{u("up"),f(a,s,"positive")},className:"cursor-pointer hover:bg-gray-200 p-1 rounded",children:"👍"}),(0,c.jsx)("button",{onClick:()=>{u("down"),f(a,s,"negative")},className:"cursor-pointer hover:bg-gray-200 p-1 rounded",children:"👎"})]}):"up"===h?(0,c.jsx)("button",{className:"cursor-pointer bg-gray-200 text-white p-1 rounded",children:"👍"}):(0,c.jsx)("button",{className:"cursor-pointer bg-gray-200 text-white p-1 rounded",children:"👎"})})]}):"indicator"===t?(0,c.jsx)("img",{src:i("typing.gif"),alt:"Typing...",className:"w-10 h-5 object-contain",style:{imageRendering:"auto"}}):n}):(0,c.jsx)("div",{style:{display:"none"}})},w=o.memo(y);if("undefined"!=typeof document){const e=document.createElement("style");e.textContent="\n  .chat-bubble-user {\n    color: black;\n    position: relative;\n    border-radius: 1rem 1rem 0 1rem;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n    text-align: left;\n  }\n\n  .chat-bubble-bot {\n    color: #253E54;\n    position: relative;\n    border-radius: 1rem 1rem 1rem 0;\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);\n    text-align: left;\n  }\n\n",document.head.appendChild(e)}function v(e){let{messages:t,endRef:n}=e;return console.log(t),(0,c.jsxs)("div",{className:"chat-window flex-1 p-3 overflow-y-auto flex flex-col space-y-2",children:[t.map(((e,t)=>(0,c.jsx)(w,{sender:e.sender,message:e.message,sentiment:e.sentiment,conversationId:e.conversationId,messageId:e.id},`${e.id}-${t}`))),(0,c.jsx)("div",{ref:n})]})}const x=(0,o.forwardRef)(((e,t)=>{let{value:n,placeholder:o,onChange:a,onKeyDown:s,disabled:r}=e;return(0,c.jsx)("input",{ref:t,type:"text",value:n,onChange:a,onKeyDown:s,placeholder:o,disabled:r,className:"w-full p-4 text-sm text-gray-700 bg-gray-50 rounded-lg focus:outline-none disabled:cursor-not-allowed"})})),k=o.memo(x),j=e=>{let{onClick:t,icon:n,style:o}=e;return(0,c.jsx)("button",{onClick:t,style:{backgroundColor:"#fc6b2d",...o},className:"fixed bottom-4 right-4 text-white p-4 w-14 h-14 rounded-full shadow-lg flex items-center justify-center",children:n||"💬"})},C=o.memo(j),I=e=>{let{text:t,onClick:n}=e;return(0,c.jsx)("div",{onClick:n,className:"bg-gray-50 p-4 rounded-lg cursor-pointer hover:bg-gray-100",children:t})},P=o.memo(I),O=["Which type of account is right for my business?","How do I find and securely store my PortOne API keys and secret keys after creating my account?","What are the different integration types offered by PortOne (web, mobile, plugins, API), and which one is best suited for my platform? How do I choose the best type for my business?","How do I configure payment channels and payment methods within the PortOne merchant portal? What information do I need to provide for each payment channel?","What is the PortOne integration test plan, and how can I effectively test my integration before going live? What are some common errors I should watch out for during testing?","What is included in the PortOne Go-Live Checklist, and what steps should I take to ensure a smooth transition to a live environment?","What are the prerequisites for integrating with the PortOne Payment API?","How does JWT authentication work with the PortOne APIs, and how do I generate a JWT token?","How do I generate a payment request signature for my payment requests?","What are the differences between the PortOne Payment Service and Checkout Service for web integration?","How do I integrate the PortOne Web SDK (Payment Service and Checkout Service) into my website?","How do I handle the different types of payment responses (redirect parameters, webhooks)? How can I verify the signatures in my responses?","How do I configure webhooks to receive real-time notifications from PortOne about payment statuses and refunds? What are the specific details included in these webhook responses?","How does the refund process work with PortOne, and how do I initiate a refund?","What are the differences between the Embed, Connect, and Custom SDK integration options for mobile? Which option is best for my app's needs and resources?","How do I integrate the PortOne mobile SDK (Android, iOS, Flutter, React Native) into my application? What are the specific steps and code examples for each platform?","How do I handle payment status updates and deep links in my mobile app after a payment is completed?","What are the key considerations for embedding a checkout experience within an iframe using the mobile SDKs?","How do I create a payment link via the PortOne dashboard and the API? What parameters do I need to specify?","What are the different states a payment link can be in throughout its lifecycle?","How can I create a payment page within the PortOne dashboard? What customization options are available? What are the advantages of using a payment page over a single payment link?","How do I create and manage regular subscriptions and on-demand subscriptions using the PortOne API? What are the key differences between these subscription types?","What parameters are needed to generate a signature for regular and on-demand subscription requests?","How does the PortOne Reconciliation feature work, and how can I configure it for my business?","How do I use the PortOne Ingestion tool to upload my transaction data?","How do I interpret the data presented in the PortOne Reconciliation Dashboard, including the Sankey chart and detailed reports?","How do I create invoices through the PortOne Admin console, including using invoice templates and bulk uploads?","How do I view and manage individual invoice details within the PortOne Admin console?","What are the different error codes returned by the PortOne APIs? How can I troubleshoot common errors?","Remember to always refer to the official PortOne documentation for the most accurate and up-to-date information. These questions are a starting point to guide your exploration.","What are the differences between a Single Merchant and a Master Merchant account?","How to integrate portone web sdk in my website? Give me a step by step guide.","Can portone help me in reconciling my accounts across multiple payment gateways?","How to activate my account","How do I create a payment link via the PortOne dashboard and the API? What parameters do I need to specify?","What are the different states a payment link can be in throughout its lifecycle?","How can I create a payment page within the PortOne dashboard? What customization options are available? What are the advantages of using a payment page over a single payment link?","How do I create and manage regular subscriptions and on-demand subscriptions using the PortOne API? What are the key differences between these subscription types?","What parameters are needed to generate a signature for regular and on-demand subscription requests?","How does the PortOne Reconciliation feature work, and how can I configure it for my business?","How do I use the PortOne Ingestion tool to upload my transaction data?","How do I interpret the data presented in the PortOne Reconciliation Dashboard, including the Sankey chart and detailed reports?","How do I create invoices through the PortOne Admin console, including using invoice templates and bulk uploads?","How do I view and manage individual invoice details within the PortOne Admin console?","What are the different error codes returned by the PortOne APIs? How can I troubleshoot common errors?","Remember to always refer to the official PortOne documentation for the most accurate and up-to-date information. These questions are a starting point to guide your exploration.","What are the differences between a Single Merchant and a Master Merchant account?","How to integrate portone web sdk in my website? Give me a step by step guide.","Can portone help me in reconciling my accounts across multiple payment gateways?","How to activate my account"];function S(e){let{onSelectPrompt:t}=e;const n=o.useMemo((()=>O.sort((()=>Math.random()-.5)).slice(0,3)),[]);return(0,c.jsx)("div",{className:"space-y-2 mb-4 px-4 flex flex-col",children:n.map(((e,n)=>(0,c.jsx)(P,{text:e,onClick:()=>t?.(e)},n)))})}const N=e=>{let{onClick:t,isHistoryView:n=!1}=e;return(0,c.jsx)("div",{className:"flex items-center justify-center",children:n?(0,c.jsx)(s(),{onClick:t,src:i("back.svg"),alt:"Back",title:"Return to Chat",width:20,height:20,className:"cursor-pointer"}):(0,c.jsx)(s(),{onClick:t,src:i("history.svg"),alt:"History",title:"See Conversation History",width:20,height:20,className:"cursor-pointer"})})},H=o.memo(N);function W(e){let{conversation:t,onClick:n}=e;return(0,c.jsxs)("div",{onClick:n,className:"bg-gray-50 p-4 rounded-lg cursor-pointer hover:bg-gray-100 mb-2",children:[(0,c.jsx)("div",{children:(0,c.jsx)("p",{className:"text-sm text-gray-800",children:t.title})}),(0,c.jsx)("div",{children:(0,c.jsx)("p",{className:"text- text-gray-500",children:new Date(1e3*Number(t.created_at)).toDateString()})})]})}function A(e){let{conversations:t,onSelectConversation:n}=e;return(0,c.jsx)("div",{className:"p-4 overflow-y-auto flex-1 conversation-history",children:0===t.length?(0,c.jsx)("div",{children:"No conversations found."}):t.map((e=>(0,c.jsx)(W,{conversation:e,onClick:()=>n(e)},e.conversation_id)))})}const _=e=>{let{onClick:t}=e;return(0,c.jsx)("div",{className:"bg-[#fc6b2d] p-4 rounded-lg cursor-pointer",onClick:t,children:(0,c.jsx)(s(),{src:i("cancel.svg"),alt:"Cancel",width:20,height:20,className:"w-5 h-5 cursor-pointer"})})},R=o.memo(_);function D(){const[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)({}),[s,r]=(0,o.useState)(""),[d,h]=(0,o.useState)(!1),[u,m]=(0,o.useState)(null),[f,b]=(0,o.useState)(""),[y,w]=(0,o.useState)([]),[x,j]=(0,o.useState)(!1),I=(0,o.useRef)(null),P=(0,o.useRef)(null),O=(0,o.useRef)(null),N=(0,o.useRef)(null);(0,o.useEffect)((()=>{I.current?.scrollIntoView({behavior:"smooth"})}),[n]),(0,o.useEffect)((()=>{const e=localStorage.getItem("chat_user_id");e?(m(e),p(e).then((e=>w(e)))):async function(){return(await fetch(`${g}/api/assign_user`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()}().then((e=>{e.user_id&&(m(e.user_id),localStorage.setItem("chat_user_id",e.user_id),p(e.user_id).then((e=>w(e))))}))}),[]);const W=(0,o.useCallback)((e=>{b(e.conversation_id);const t={};Object.values(e.messages).forEach((n=>{t[n.id]={id:n.id,message:n.message,sender:"user"===n.sender?"user":"bot",sentiment:n.sentiment,conversationId:e.conversation_id}})),a(t),j(!1)}),[]),_=(0,o.useCallback)((async e=>{const t=void 0!==e?e.trim():s.trim();if(!t||!u||d)return;h(!0);const n={id:Date.now().toString(),sender:"user",message:t,sentiment:"0",conversationId:f},o=(Date.now()+1).toString();N.current=o;const i={id:o,sender:"indicator",message:"Typing...",sentiment:"0",conversationId:f};a((e=>({...e,[n.id]:n,[i.id]:i}))),r("");const c=new AbortController;O.current=c;try{const{content:e,conversationId:t}=await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;const s=await fetch(`${g}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:n,user_id:e,message:t}),signal:a});let r="",i=n;const c=new TextDecoder;let d="";if(s.body){const e=s.body.getReader();for(;;){const{done:t,value:n}=await e.read();if(t)break;d+=c.decode(n,{stream:!0});const a=d.split("\n");d=a.pop()||"";for(const e of a){const t=e.trim();if(t&&t.startsWith("data:")){const e=t.replace(/^data:\s*/,"");try{const t=JSON.parse(e);"done"===t.event?i=t.conversation_id:t.data&&(r+=t.data,o&&o(r))}catch(e){console.error("Error parsing JSON:",e,"in line:",t)}}}}}return{content:r,conversationId:i}}(u,n.message,f,(e=>{a((t=>({...t,[o]:{...t[o],sender:"bot",message:e}})))}),c.signal);b(t),a((t=>({...t,[o]:{...t[o],sender:"bot",message:e}})))}catch(e){"AbortError"===e.name?(console.log("Message sending aborted"),a((e=>{const t={...e};return delete t[o],t}))):console.error("Error sending message:",e)}finally{O.current=null,N.current=null,h(!1)}}),[s,u,d,f]),D=(0,o.useCallback)((()=>{O.current&&N.current&&O.current.abort()}),[]),E=(0,o.useCallback)((()=>{j(!1),b(""),a({}),r(""),P.current?.focus()}),[]),T=(0,o.useCallback)((e=>{_(e)}),[_]),M=(0,o.useCallback)((()=>{t((e=>!e))}),[]),$=(0,o.useCallback)((e=>{r(e.target.value)}),[]),q=(0,o.useCallback)((e=>{"Enter"===e.key&&_()}),[_]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(C,{onClick:M,icon:"💬"}),e&&(0,c.jsxs)("div",{className:"fixed bottom-20 right-4 w-96 h-[600px] bg-white rounded-lg shadow-2xl flex flex-col overflow-hidden",children:[(0,c.jsx)(l,{title:x?"Conversation History":"PortOne Support",onClose:()=>t(!1),leftComponent:(0,c.jsxs)("div",{className:"flex gap-2",children:[y.length>0&&(0,c.jsx)(H,{onClick:()=>j((e=>!e)),isHistoryView:x}),(0,c.jsx)("img",{src:i("plus.svg"),alt:"New Chat",title:"Start a New Chat",onClick:E,className:"w-6 h-6 cursor-pointer"})]})}),x?(0,c.jsx)(A,{conversations:y,onSelectConversation:W}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(v,{messages:Object.values(n||{}),endRef:I}),!Object.values(n||{}).some((e=>"user"===e.sender))&&(0,c.jsx)(S,{onSelectPrompt:T}),(0,c.jsx)("div",{className:"p-4 bg-white border-t",children:(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[(0,c.jsx)(k,{ref:P,value:s,placeholder:"Chat with Support...",onChange:$,onKeyDown:q,disabled:d}),d?(0,c.jsx)(R,{onClick:D}):(0,c.jsx)("div",{className:"bg-[#fc6b2d] p-4 rounded-lg cursor-pointer",onClick:()=>{d||_()},children:(0,c.jsx)("img",{src:i("send.svg"),className:"w-5 h-5 text-white"})})]})})]})]})]})}function E(){return(0,c.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,c.jsx)(D,{})})}function T(){return(0,c.jsx)(E,{})}}}]);